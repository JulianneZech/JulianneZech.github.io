<style>


path {
  stroke: #fff;
  stroke-width: .5;
  stroke-dasharray: 1;
  fill: #afafaf;
}

#neighborhoodPopover { 
  position: absolute;     
  text-align: center;         
  padding: 2px;       
  font: 12px sans-serif;    
  background: #fff; 
  border: 0px;    
  border-radius: 8px;     
  pointer-events: none;
  opacity: 0;     
}
  
.pin {
  width: 720;
  height: 120;
  cx: 30;
  cy: 60;
  r: 5;
  style: steelblue;  
}
  
.dot {
  height: 25px;
  width: 25px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
}
	
.bootstrap-select.btn-group .dropdown-menu {
  background-color: yellow;
}
 

</style>
	
<body>
  <svg width="960" height="720"></svg>
  <div id='neighborhoodPopover'> </div>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>
	
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>
<script>

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
	
var nycity;

// http://data.beta.nyc//dataset/0ff93d2d-90ba-457c-9f7e-39e47bf2ac5f/resource/35dd04fb-81b3-479b-a074-a27a37888ce7/download/d085e2f8d0b54d4590b1e7d1f35594c1pediacitiesnycneighborhoods.geojson
d3.json("nyc.json", function(error, nyc) {
  if (error) throw error;

  nycity = nyc;

  var path = d3.geoPath()
      .projection(d3.geoConicConformal()
      .parallels([33, 45])
      .rotate([96, -39])
      .fitSize([width, height], nyc));

  svg.selectAll("path")
      .data(nyc.features)
      .enter().append("path")
      .attr("d", path)
      .on("mouseenter", function(d) {
	      d3.select(this)
	      .style("stroke-width", 1.5)
	      .style("stroke-dasharray", 0)

	      d3.select("#neighborhoodPopover")
	      .transition()
	      .style("opacity", 1)
	      .style("left", (d3.event.pageX) + "px")
	      .style("top", (d3.event.pageY) + "px")
	      .text(d.properties.NTAName)
    })
  
      .on("mouseleave", function(d) { 
	      d3.select(this)
	      .style("stroke-width", .25)
	      .style("stroke-dasharray", 1)

	      d3.select("#cneighborhoodPopoverountyText")
	      .transition()
	      .style("opacity", 100);
    });

  console.log(nyc);
  
  $.ajax({
    url: "https://data.cityofnewyork.us/resource/43nn-pn8j.json",
    type: "GET",
    data: {
      cuisine_description : 'Afghan',
      "$limit" : 50000000,
      "$$app_token" : "vjYOozd5OGcoGpTencAURAUw5"
    }
    }).done(function(data) {
      alert("Retrieved " + data.length + " records from the dataset!");
      console.log(data);
    
     var projection = d3.geoConicConformal().rotate([96, -39]).fitSize([width, height], nycity);
     var path = d3.geoPath().projection(projection);
	  
     var dropDown = d3.select("body").append("select")
                      .attr("name", "name-list")
                      .attr("id", "cuisinepicker");
	  
     var unique = d3.set(data, function(d) {return d.cuisine_description});
     var unique_values = d3.set(unique).values();
     //$('unique_values').prepend('<option value="">');
     //unique_values.prepend("Select a cuisine type");
	
     var sorted = unique_values.sort();
	  
     var options = dropDown.selectAll("option")
     .attr("id", "cuisineselector")
     .data(unique_values)
     .enter()
     .append("option");
      
     //options.prop("selectedIndex", -1);
     //$('#cuisinepicker').prepend('<option value="">');
     //$("#cuisineselector").prepend("<option value=''></option>").val('');
     $("#cuisinepicker").selectpicker({
        noneSelectedText : 'Select a Cuisine Type',
	//showContent : false,
	showTick: true
    });
	  
	  
      // A function that update the color of the circle
      function updateChart(cuisineType) {

	  var dataToPlot = data.filter(function(d) {return d.cuisine_description == cuisineType;})
	  
     	  svg.selectAll("circle")
		.data(dataToPlot)
	        .enter()
		.append("circle")
	        .attr("class", "circles")
	  	.attr("r", "1.5px")
		.attr("fill", "black")
	        .attr("cx", function (d) { return projection([d.longitude, d.latitude])[0]; })
		.attr("cy", function (d) { return projection([d.longitude, d.latitude])[1]; })
	        .on("mouseenter", function(d) {
		      d3.select(this)
		      .style("stroke-width", 1.5)
		      .style("stroke-dasharray", 0)
		 

		      d3.select("#neighborhoodPopover")
		      .transition()
		      .style("opacity", 1)
		      .style("left", (d3.event.pageX) + "px")
		      .style("bottom", (d3.event.pageY) + "px")
		      .text(d.dba)
		        console.log("dba");
		  	console.log(d.dba);
		        console.log(this);
		})

		    .on("mouseleave", function(d) { 
		      d3.select(this)
		      .style("stroke-width", .25)
		      .style("stroke-dasharray", 1)

		      d3.select("#cneighborhoodPopoverountyText")
		      .transition()
		      .style("opacity", 100);
    		});
      } // end updateChart
	  
	  

	// When the button is changed, run the updateChart function
      dropDown.on("change", function(d) {
	      
	    svg.selectAll("circle").remove();

	    // recover the option that has been chosen
	    var selectedOption = d3.select(this).property("value");

	    // run the updateChart function with this selected option
	    updateChart(selectedOption);
      })
	  
      options.text(function(d) {
	return d;
      })
      .attr("value", function(d) {
	//console.log(d);
	return d;
      });
	  
    });

});

</script>
